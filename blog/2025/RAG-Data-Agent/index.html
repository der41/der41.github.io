<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Unlocking Economics, How AI democratize data access | Diego E. Rodriguez </title> <meta name="author" content="Diego E. Rodriguez"> <meta name="description" content="Ever felt lost in a sea of economic data, desperately searching for that one crucial indicator? The world of finance can be overwhelming, with countless metrics and complex datasets often locked away or difficult to navigate. But what if accessing and understanding this information became as simple as having a conversation?"> <meta name="keywords" content="Data Science, AI, Machine Learning, Analytics"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/moai.png?db14a62c16a07eee1eaaf9b1798fe922"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://der41.github.io/blog/2025/RAG-Data-Agent/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Unlocking Economics, How AI democratize data access",
            "description": "Ever felt lost in a sea of economic data, desperately searching for that one crucial indicator? The world of finance can be overwhelming, with countless metrics and complex datasets often locked away or difficult to navigate. But what if accessing and understanding this information became as simple as having a conversation?",
            "published": "April 13, 2025",
            "authors": [
              
              {
                "author": "Diego Rodriguez",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Duke University",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Diego</span> E. Rodriguez </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Unlocking Economics, How AI democratize data access</h1> <p>Ever felt lost in a sea of economic data, desperately searching for that one crucial indicator? The world of finance can be overwhelming, with countless metrics and complex datasets often locked away or difficult to navigate. But what if accessing and understanding this information became as simple as having a conversation?</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#context">Context</a> </div> <ul> <li> <a href="#the-power-of-ai-in-reducing-information-gaps">The Power of AI in reducing information gaps</a> </li> <li> <a href="#why-data-description-are-a-good-use-case-of-embeddings-and-llms">Why data description are a good use case of embeddings and LLMs</a> </li> </ul> <div> <a href="#walkthrough">Walkthrough</a> </div> <ul> <li> <a href="#from-csv-to-vector-database">From CSV to Vector Database</a> </li> <li> <a href="#then-is-all-about-the-workflow">Then, is all about the workflow</a> </li> </ul> <div> <a href="#demo">Demo</a> </div> </nav> </d-contents> <h2 id="context">Context:</h2> <h3 id="the-power-of-ai-in-reducing-information-gaps">The Power of AI in Reducing Information Gaps</h3> <p>Imagine trying to analyze economic trends. You might know what you’re looking for, but navigating vast databases can be time-consuming and frustrating. Sources like the Central Bank of Chile contain over 20,000 economic records. This wealth of information, while incredibly valuable, is often inaccessible to the average user who lacks the specific knowledge required to query and retrieve the data. EcoDataBot steps in as a powerful helper, bridging this gap and making extensive data readily available.</p> <h3 id="why-are-data-descriptions-a-good-use-case-for-embeddings-and-llms">Why Are Data Descriptions a Good Use Case for Embeddings and LLMs?</h3> <p>The unique structure of the data available from the Central Bank of Chile portal makes it an ideal candidate for embedding techniques. The code descriptions can be very similar to one another, with only small changes in wording that differentiate one indicator from the next. The contextual richness of each description enables Gemini to distinguish between variable transformations and variable names, allowing the model to guide the user toward the correct answer through an iterative process. In this case, the descriptions are available in both English and Spanish.</p> <p>Here’s how the data looks for the total monthly indicator of economic activity (and this is without counting the 8 other subcategories for each indicator that would appear if we ran an SQL query for “monthly indicator of economic activity”):</p> <table> <thead> <tr> <th>Name</th> <th>Nombre</th> <th>CODE</th> </tr> </thead> <tbody> <tr> <td>National Accounts, Monthly indicator of economic activity, Imacec, chained volume at previous prices, spliced time series (2018 index=100)#G, Imacec</td> <td>Cuentas Nacionales, Indicador mensual de actividad económica, Imacec, volumen a precios del año anterior encadenado, series empalmadas (promedio 2018=100), Imacec</td> <td>F032.IMC.IND.Z.Z.EP18.Z.Z.0.M</td> </tr> <tr> <td>National Accounts, Monthly indicator of economic activity, Imacec, contribution compared with the same period of the previous year, reference 2018, Imacec</td> <td>Cuentas Nacionales, Indicador mensual de actividad económica, Imacec, contribución porcentual respecto de igual periodo del año anterior, referencia 2018, Imacec</td> <td>F032.IMC.V12.Z.Z.2018.Z.Z.0.M</td> </tr> <tr> <td>National Accounts, Monthly indicator of economic activity, Imacec, contribution to monthly growth, seasonally adjusted, reference 2018, Imacec</td> <td>Cuentas Nacionales, Indicador mensual de actividad económica, Imacec, contribución porcentual respecto al periodo anterior, desestacionalizado, referencia 2018, Imacec</td> <td>F032.IMC.VAR.Z.Z.2018.Z.Z.3.M</td> </tr> </tbody> </table> <p>As you can see by closely examining the data, dividing it into standardized metadata is not a viable option. The information is not structured consistently—some series may or may not include details like unit, frequency, or category. This is where the magic of semantic search comes in! Instead of just matching keywords, semantic search understands the meaning behind your query. It does this by converting both your query and the data (like the 20,000+ economic records in EcoDataBot’s dataset) into numerical representations called embeddings. These embeddings capture the underlying semantic relationships, so that concepts with similar meanings are positioned close to one another in a vector space.</p> <p>LLMs are particularly effective when using vector datasets to enhance their answer capabilities. To do this meaningfully, they require an ecosystem that provides the right tools in the right context. This is where LangGraph and LangChain shine—guiding Gemini 2.0 in the right direction. The process ensures that the model asks the user for their requirements, retrieves information from the vector dataset, and only consults the API once it has sufficient confirmation. The diagram below summarizes the functionalities:</p> <div style="width: 90%; margin: 0 auto; text-align: center;"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/rag_diagram-480.webp 480w,/assets/img/rag_diagram-800.webp 800w,/assets/img/rag_diagram-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/rag_diagram.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <hr> <h2 id="walkthrough">Walkthrough</h2> <h3 id="from-csv-to-vector-database">From CSV to Vector Database</h3> <p>To pass the CSV data into a vector database, first I load the <code class="language-plaintext highlighter-rouge">catalogo.csv</code> file using the pandas library and removes any duplicate entries based on the <code class="language-plaintext highlighter-rouge">CODE</code> column. It then creates a combined text field called search_text using the ‘Name’ and ‘Nombre’ columns from the CSV, which contains descriptions of the economic series in both English and Spanish.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load your CSV
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">/kaggle/input/bcch-catalogue/catalogo.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">CODE</span><span class="sh">"</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="sh">"</span><span class="s">first</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Handle missing values before creating search_text
</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Nombre</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Nombre</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">CODE</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">CODE</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>

<span class="c1"># Create combined text with fallback
</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">search_text</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Nombre</span><span class="sh">"</span><span class="p">]</span>

<span class="c1"># Remove any remaining empty strings/NULLs
</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">search_text</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">search_text</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">""</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">^</span><span class="se">\\</span><span class="s">s+$</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Create combined text for semantic search
</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">search_text</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">Nombre</span><span class="sh">"</span><span class="p">]</span>

<span class="c1"># Create metadata storage
</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sh">"</span><span class="s">CODE</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nombre</span><span class="sh">"</span><span class="p">]].</span><span class="nf">to_dict</span><span class="p">(</span><span class="sh">"</span><span class="s">records</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Next, it initializes a Chroma vector database client. The agent uses the <code class="language-plaintext highlighter-rouge">text-embedding-004</code> model from the Google GenAI class as its embedding function to convert the search_text into numerical vector embeddings.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define a helper to retry when per-minute quota is reached.
</span><span class="n">is_retriable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">genai</span><span class="p">.</span><span class="n">errors</span><span class="p">.</span><span class="n">APIError</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="p">.</span><span class="n">code</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">429</span><span class="p">,</span> <span class="mi">503</span><span class="p">})</span>

<span class="c1">#GeminiEmbedding Used during the Kaggle Google GenAI Course
</span><span class="k">class</span> <span class="nc">GeminiEmbeddingFunction</span><span class="p">(</span><span class="n">EmbeddingFunction</span><span class="p">):</span>
    <span class="c1"># Specify whether to generate embeddings for documents, or queries
</span>    <span class="n">document_mode</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="nd">@retry.Retry</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="n">is_retriable</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">Documents</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Embeddings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">document_mode</span><span class="p">:</span>
            <span class="n">embedding_task</span> <span class="o">=</span> <span class="sh">"</span><span class="s">retrieval_document</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">embedding_task</span> <span class="o">=</span> <span class="sh">"</span><span class="s">retrieval_query</span><span class="sh">"</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nf">embed_content</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">models/text-embedding-004</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">types</span><span class="p">.</span><span class="nc">EmbedContentConfig</span><span class="p">(</span>
                <span class="n">task_type</span><span class="o">=</span><span class="n">embedding_task</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">embeddings</span><span class="p">]</span>

<span class="c1">#Initialize ChromaDB
</span><span class="n">chroma_client</span> <span class="o">=</span> <span class="nc">Client</span><span class="p">()</span>
<span class="n">embed_fn</span> <span class="o">=</span> <span class="nc">GeminiEmbeddingFunction</span><span class="p">()</span>
<span class="n">embed_fn</span><span class="p">.</span><span class="n">document_mode</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="p">.</span><span class="nf">get_or_create_collection</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">bcch_indicators</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">embedding_function</span><span class="o">=</span><span class="n">embed_fn</span>
<span class="p">)</span>
</code></pre></div></div> <p>Finally, it adds these embeddings, along with the corresponding <code class="language-plaintext highlighter-rouge">CODE</code> as unique identifiers and the ‘CODE’, ‘Name’, and ‘Nombre’ columns as metadata, into the Chroma vector database in batches for efficient processing.</p> <p>The final output of this process is a populated Chroma vector database containing vector embeddings of the economic series descriptions and their associated metadata, enabling semantic search capabilities.</p> <h3 id="then-is-all-about-the-workflow">Then, is all about the workflow</h3> <p>Now that we have the main search capability to enrich the filtering capacity of the LLM is moment to add the workflow using Langraphs and Langchain.</p> <p>First, defining the tools that are then integrated into a langgraph framework using distinct nodes that define the agent’s workflow:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">chroma_search_series</code> tool leverages Gemini’s semantic capabilities to query a Chroma vector database containing embeddings of economic series descriptions, taking a text query as input and returning the most relevant series codes and descriptions</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">chroma_search_series</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">n_results</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="sh">"</span><span class="s">Number of results to return</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">Search economic series using semantic similarity.</span><span class="sh">"""</span>
    <span class="n">embed_fn</span><span class="p">.</span><span class="n">document_mode</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Query mode
</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span>
        <span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="n">query</span><span class="p">],</span>
        <span class="n">n_results</span><span class="o">=</span><span class="n">n_results</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Extract and format metadata
</span>    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="sh">"</span><span class="s">code</span><span class="sh">"</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="sh">"</span><span class="s">CODE</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">nombre</span><span class="sh">"</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="sh">"</span><span class="s">Nombre</span><span class="sh">"</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">metadatas</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">]</span>
</code></pre></div></div> <ul> <li> <code class="language-plaintext highlighter-rouge">get_series</code> tool is responsible for retrieving actual time series data from the Central Bank of Chile’s Economic Portal API based on parameters extracted from tool calls</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_series</span><span class="p">(</span><span class="n">json_input</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Processes input JSON/dict from the LLM and retrieves data from the BCCh.

    Args:
        json_input (str/dict): Input JSON/dict. Example:
            {
                </span><span class="sh">"</span><span class="s">series</span><span class="sh">"</span><span class="s">: [</span><span class="sh">"</span><span class="s">F032.IMC.IND.Z.Z.2008.03.Z.0.M</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">F032.IMC.IND.Z.Z.EP18.N03.Z.0.M</span><span class="sh">"</span><span class="s">],
                </span><span class="sh">"</span><span class="s">nombres</span><span class="sh">"</span><span class="s">: [</span><span class="sh">"</span><span class="s">imacec minero</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">imacec no-minero</span><span class="sh">"</span><span class="s">],
                </span><span class="sh">"</span><span class="s">desde</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">2014-01-01</span><span class="sh">"</span><span class="s">,
                </span><span class="sh">"</span><span class="s">hasta</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">2024-01-01</span><span class="sh">"</span><span class="s">
            }

    Returns:
        str: Data returned as a formatted JSON string, including intuitive names for each series.
    </span><span class="sh">"""</span>

    <span class="c1"># Sanitize input (replace curly quotes, etc.)
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">json_input</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sanitized</span> <span class="o">=</span> <span class="n">json_input</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">“</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'"'</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">”</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'"'</span><span class="p">).</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">ascii</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">).</span><span class="nf">decode</span><span class="p">()</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">sanitized</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Input should be a JSON string or a dictionary, not a list. Please remove extra commentary.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">json_input</span>

    <span class="c1"># If 'json_input' key exists, use its value
</span>    <span class="k">if</span> <span class="sh">"</span><span class="s">json_input</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">json_input</span><span class="sh">"</span><span class="p">]</span>

    <span class="c1"># Normalize keys to lower-case
</span>    <span class="n">params_lower</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="p">.</span><span class="nf">items</span><span class="p">()}</span>

    <span class="c1"># Validate required keys
</span>    <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">series</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">desde</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params_lower</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Parámetros faltantes: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Ensure 'series' is a list
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">params_lower</span><span class="p">[</span><span class="sh">"</span><span class="s">series</span><span class="sh">"</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"'</span><span class="s">series</span><span class="sh">'</span><span class="s"> debe ser una lista.</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Format dates (forcing YYYY-MM-DD)
</span>    <span class="n">date_format</span> <span class="o">=</span> <span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">desde</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">params_lower</span><span class="p">[</span><span class="sh">"</span><span class="s">desde</span><span class="sh">"</span><span class="p">]).</span><span class="nf">strftime</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
        <span class="n">hasta</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">params_lower</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">hasta</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">today</span><span class="sh">"</span><span class="p">)).</span><span class="nf">strftime</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Formato de fecha inválido. Use YYYY-MM-DD.</span><span class="sh">"</span><span class="p">)</span> <span class="k">from</span> <span class="n">e</span>

    <span class="c1"># Retrieve data in chunks (max 2 series per API call)
</span>    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">params_lower</span><span class="p">[</span><span class="sh">"</span><span class="s">series</span><span class="sh">"</span><span class="p">]),</span> <span class="n">chunk_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">params_lower</span><span class="p">[</span><span class="sh">"</span><span class="s">series</span><span class="sh">"</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunk_size</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">siete</span><span class="p">.</span><span class="nf">cuadro</span><span class="p">(</span>
                <span class="n">series</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
                <span class="n">desde</span><span class="o">=</span><span class="n">desde</span><span class="p">,</span>
                <span class="n">hasta</span><span class="o">=</span><span class="n">hasta</span>
            <span class="p">)</span>
            <span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">all_data</span><span class="p">,</span> <span class="n">data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error BCCH en series </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Convert all data to numeric values
</span>    <span class="n">all_data</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">coerce</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">.</span><span class="nf">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="sh">"</span><span class="s">list</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Retrieve the intuitive names; if none are provided, default to empty strings
</span>    <span class="n">nombres</span> <span class="o">=</span> <span class="n">params_lower</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">nombres</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="sh">""</span><span class="p">]</span> <span class="o">*</span> <span class="nf">len</span><span class="p">(</span><span class="n">params_lower</span><span class="p">[</span><span class="sh">"</span><span class="s">series</span><span class="sh">"</span><span class="p">]))</span>

    <span class="c1"># Build a list of objects where each object contains the code, the intuitive name, and the values
</span>    <span class="n">series_codes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span>
    <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">series_codes</span><span class="p">):</span>
        <span class="c1"># Use the corresponding intuitive name if available; otherwise, fall back to the code itself
</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">nombres</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">nombres</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nombres</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="n">code</span>
        <span class="n">data_list</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">code</span><span class="sh">"</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">values</span><span class="sh">"</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="c1"># Convert the final result to a JSON string with indentation
</span>    <span class="n">json_result</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">data_list</span><span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json_result</span>
</code></pre></div></div> <p>Second, defining the nodes of interactions within the model</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">human_node</code> manages user interaction by displaying the last bot message and prompting for new input, or showing a welcome message initially.</li> <li>The <code class="language-plaintext highlighter-rouge">chatbot_node</code> takes the conversation history and system instructions to invoke the Gemini 2.0 model to generate the assistant’s response.</li> <li>The <code class="language-plaintext highlighter-rouge">search_tool_node</code> is activated when a search tool call is made, using <code class="language-plaintext highlighter-rouge">chroma_search_series</code> to find relevant economic series and format the results.</li> <li>The <code class="language-plaintext highlighter-rouge">data_tool_node</code> is triggered for data retrieval tool calls, using <code class="language-plaintext highlighter-rouge">get_series</code> to fetch data and optionally plot it.</li> <li>The <code class="language-plaintext highlighter-rouge">route_decision</code> node acts as the workflow’s control, determining the next node to activate based on the current conversation state, including checking for the end of the conversation or the type of the last message and its tool calls.</li> </ul> <p>The entire workflow is orchestrated by creating a <code class="language-plaintext highlighter-rouge">StateGraph</code> in LangGraph and defining conditional edges based on the <code class="language-plaintext highlighter-rouge">route_decision</code> function, with the Gemini 2.0 model integrated using ChatGoogleGenerativeAI and the defined tools bound to it. The following code resume the zero-prompting technique used on this bot:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define state management using of the Economic Bot
</span><span class="k">class</span> <span class="nc">AnalysisState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">State representing financial data analysis conversation.</span><span class="sh">"""</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">add_messages</span><span class="p">]</span>
    <span class="n">current_series</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">raw_data</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">finished</span><span class="p">:</span> <span class="nb">bool</span>

<span class="n">FINANCIAL_SYSINT</span> <span class="o">=</span> <span class="nc">SystemMessage</span><span class="p">(</span>
    <span class="n">content</span><span class="o">=</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">You are EconomicDataBot, an interactive system for accessing and analyzing data from the Central Bank of Chile. </span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">Your capabilities include:</span><span class="se">\n</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">1. Searching for relevant economic series using </span><span class="sh">'</span><span class="s">search_series</span><span class="sh">'</span><span class="s">.</span><span class="se">\n</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">2. Retrieving time series data with </span><span class="sh">'</span><span class="s">get_series</span><span class="sh">'</span><span class="s">.</span><span class="se">\n</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">3. Clarifying and confirming user requests with follow-up questions.</span><span class="se">\n</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">4. Validating series IDs and date parameters to ensure they match the official nomenclature.</span><span class="se">\n</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">5. Presenting results in clear, structured formats (tables, lists, or JSON as needed).</span><span class="se">\n\n</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">6. Once you have the data return a summary of the information of the data retrieved</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">Always confirm that the series IDs match the official nomenclature and verify the date ranges before fetching data. </span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">Maintain a professional, clear, and approachable tone in your responses. </span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">If the input is ambiguous or incomplete, ask the user for clarification. </span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">Your goal is to help users access the most relevant economic data accurately and efficiently.</span><span class="sh">"</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Updated welcome message for initiating conversation
</span><span class="n">WELCOME_MSG</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sh">"</span><span class="s">I am EconomicDataBot, here to help you search, validate, and retrieve economic data. </span><span class="sh">"</span>
    <span class="sh">"</span><span class="s">How can I assist you today? </span><span class="sh">"</span>
    <span class="sh">"</span><span class="s">For example, you can ask for a specific time series or provide criteria to search for the data you need.</span><span class="sh">"</span>
<span class="p">)</span>
</code></pre></div></div> <hr> <h2 id="application-at-work">Application at work</h2> <p>Now the EcoDataBot application is ready for action give it a try at this Kaggle competition or if you prefer a live demo check out this <a href="https://youtu.be/SGp0rEnYl2M" rel="external nofollow noopener" target="_blank">video</a>. From the minute <a href="https://youtu.be/SGp0rEnYl2M?si=7OqINGhIfVSAb-D9&amp;t=634" rel="external nofollow noopener" target="_blank">10:34</a> when I start using the app.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/false"></d-bibliography> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"der41/der41.github.io","data-repo-id":"R_kgDONUPMiQ","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Diego E. Rodriguez. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>